# IT 기획서: 할인·프로모션 실질가치 계산기 (Promo Value Calculator)

## 0. 문서 정보
- 버전: v1(MVP)
- 작성일: 2026-02-10
- 목적: 장바구니 기준으로 쿠폰/배송쿠폰 적용 결과를 정확히 계산하고 최적 조합을 추천하는 웹앱

---

## 1. 문제 정의 (가장 중요)

### 1.1 해결하려는 문제(구체적으로)
사용자는 쿠폰/프로모션을 적용할 때 **표면 할인율**이 아니라 **실제 결제액과 실질 할인율**을 알고 싶다. 하지만
`minSpend`, `cap`, `적용 순서`, `중복 규칙`, `배송비` 등 정책 조건이 복합적으로 섞여 있어서
**어떤 쿠폰이 더 이득인지**를 즉시 판단하기 어렵다. 이로 인해 사용자는 다음 문제를 겪는다.
- 잘못된 선택으로 실제 할인액이 줄어듦
- 계산을 여러 번 반복해야 해서 시간/오류 비용이 증가
- 플랫폼마다 정책이 달라 혼란이 누적됨

**핵심 문제 한 줄 요약**:  
복합 할인 정책 때문에 “실질 결제액 기준으로 최적 쿠폰을 선택”하기 어렵다.

### 1.2 왜 이 문제를 선택했는가(근거)
- 실무/일상에서 쿠폰 사용 빈도가 높아 **실제 의사결정 비용이 큰 문제**다.
- 정책(적용 순서/최소금액/상한/중복 규칙)은 늘 존재하며, **수동 계산은 오류 가능성이 높다**.
- 명확한 정책을 고정하면 **재현 가능한 계산**과 **검증 가능한 결과**를 만들 수 있어, 평가 기준의 “정확성/검증성”과 정합하다.

### 1.3 목표(측정 가능한 결과)
다음 결과를 **정책 고정** 하에 재현 가능하게 계산한다.
1) 최종 결제액  
2) 쿠폰별 실제 할인액(적용 내역)  
3) 실질 할인율 2종(상품 기준 / 총액 기준)  
4) 가능한 조합 중 결제액 최소 Top3 추천  

### 1.4 핵심 기능 vs 부가 기능
**핵심 기능(MVP)**
1. 장바구니 입력(상품명/가격/수량, 배송비)
2. 쿠폰 입력 및 검증
   - %할인 쿠폰: rate, minSpend, cap
   - 정액 쿠폰: amount, minSpend, cap(선택)
   - 배송 쿠폰: shippingDiscount(금액형), cap(선택)
3. 계산 결과 출력
   - 최종 결제액, 쿠폰별 할인액, 실질 할인율(2종)
4. 추천
   - 가능한 조합 중 결제액 최소 Top3
   - 정렬 기준: **결제액 최소 → 총할인액 큰 순 → 입력 순서 유지**

**부가 기능(v2+ 후보)**
- 확률형 프로모션 EV 계산
- 포인트/캐시백 환산(가중치)
- 정책 선택(플랫폼별 정책 변경)
- 장바구니 분할 구매 전략 추천

### 1.5 대상 사용자 정의
- 쿠폰이 많아 선택이 어려운 사용자(멤버십/플랫폼 다중 이용)
- 할인 비교에 시간을 쓰기 싫은 사용자(빠른 의사결정 필요)
- 계산 실수로 손해 본 경험이 있는 사용자

### 1.6 사용자 시나리오
**S1. %쿠폰 vs 정액쿠폰 비교**
- 장바구니: 59,000원, 배송 3,000원
- C1: 20%(cap 8,000, min 50,000), C2: 7,000(min 40,000)
- 결과: C1 결제액 54,000 / C2 결제액 55,000 → C1 추천

**S2. 배송쿠폰 효과 확인**
- 장바구니: 19,900원, 배송 3,000원
- 무료배송 쿠폰(cap 3,000)
- 결과: 배송비 0원 처리, 최종 결제액 19,900원

**S3. 최소금액 미달**
- 장바구니: 28,000원, 배송 3,000원
- 6,000원 쿠폰(min 30,000)
- 결과: 적용 실패, 부족 2,000원 안내, 최종 결제액 31,000원

### 1.7 예상되는 예외 상황(엣지 케이스) 및 처리 방안
- 할인액이 기준금액 초과: `discount = min(calculated, baseAmount, cap)`로 클램프
- 배송쿠폰이 배송비 초과: 배송비는 0원 미만 불가
- minSpend 미달: 적용 실패 + “부족 금액” 표시
- 입력 이상치(음수/0): 입력 단계 validation 에러
- 중복 규칙 위반: UI에서 선택 차단 + 추천 조합 생성 시 제외
- 제외 카테고리 등 복잡 조건: v1에서는 Out of Scope로 명시

---

## 2. 정책/가정(정의 고정: MVP)
- 적용 순서: **가격 쿠폰 → 배송 쿠폰**
- minSpend 기준: **상품 정가 합계(배송비 제외)**
- 반올림: **원 단위 버림(floor)**
- 중복 규칙: **가격 쿠폰 1장 + 배송 쿠폰 1장 동시 가능**(각 그룹 내 중복 불가)
- 실질 할인율 정의:
  - 상품 기준: **총할인액 / 상품정가합**
  - 총액 기준: **총할인액 / (상품정가합 + 배송비)**
- 할인 계산 순서: **계산 → cap/base 클램프 → floor**
- cap 미설정 시: **무제한(∞)**

### 2.1 정책 결정표
| 정책 항목 | 선택 | 이유 |
| --- | --- | --- |
| 적용 순서 | 가격 쿠폰 → 배송 쿠폰 | 대부분 플랫폼 정책과 유사하고, 사용자가 가장 이해하기 쉬운 흐름 |
| minSpend 기준 | 상품 정가 합계(배송비 제외) | 쿠폰 조건에서 배송비 제외가 일반적이며, 기준 일관성 확보 |
| 반올림 | 원 단위 버림(floor) | 보수적 계산(과대 할인 방지) 및 정책 고정 |
| 중복 규칙 | 가격 1장 + 배송 1장 | MVP 범위에서 조합 복잡도 최소화 |
| cap 처리 | `min(raw, base, cap)` | 할인 상한/기준금액 초과 방지 |

---

## 3. 기대되는 결과
- 사용자는 “어떤 쿠폰이 진짜 이득인지”를 **숫자(결제액/할인율)**로 즉시 확인
- 쿠폰 선택 의사결정 시간 단축
- 정책 위반/조건 누락으로 인한 계산 오류 감소

---

## 4. 정보 구조(IA) & 화면 기획(웹앱)

### 4.1 화면 구성
1) 입력 화면
- 장바구니 입력(아이템 리스트)
- 배송비 입력
- 쿠폰 추가(가격쿠폰/배송쿠폰)
- 정책/가정 표시(Policy A, minSpend 기준, 반올림)

2) 결과 화면
- 최종 결제액(핵심 KPI)
- 적용 내역(쿠폰별 할인액)
- 실질 할인율(상품 기준/총액 기준)
- 추천 조합 Top3 + “왜 이 조합인가”(간단 사유)

3) 비교 화면(선택)
- 쿠폰 A vs B 결제액/할인율 비교

### 4.2 UX 포인트
- 모든 결과에 “계산 기준(정책/반올림/minSpend)” 노출
- 실패 케이스는 ‘불가’가 아니라 사유+부족금액 안내
- 추천 결과는 Top3 제공(사용자 선택권 유지)

---

## 5. 할인 계산 수식(명시)
- %쿠폰:
  - `raw = base * rate`
  - `discount = floor(min(raw, cap, base))`
- 정액 쿠폰:
  - `discount = floor(min(amount, cap?, base))`
- 배송 쿠폰(금액형):
  - `discount = floor(min(shippingDiscount, cap?, shippingFee))`
  - 배송비는 0원 미만 불가

---

## 6. 기술 스택
- Frontend: Next.js(React), TypeScript
- Backend: Spring Boot (Java)
- Core Logic: 순수 함수 기반 계산 엔진(테스트 용이)
- Test: JUnit 5 + JaCoCo
- OpenAPI: Swagger UI

---

## 7. 기술 범위(Scope)
**Scope(v1)**
- 단일 주문(장바구니 1개) + 가격쿠폰 1장 + 배송쿠폰 1장 조합 추천
- %/정액/배송 쿠폰 3종 지원
- Policy A/minSpend/반올림 규칙 고정
- 입력: 가격쿠폰 N개 + 배송쿠폰 M개 입력 가능, 조합은 각 그룹 1장씩만 추천

**Out of Scope(v1)**
- 확률형 프로모션 EV, 포인트/캐시백 환산
- 제외 카테고리/결제수단 제한/시간 제한 등 복잡 조건
- 장바구니 분할, 세금/관부가세, 플랫폼별 정책 선택

---

## 8. 시나리오 요약표
| ID | 입력 요약 | 기대 결과 |
| --- | --- | --- |
| S1 | subtotal=59,000 / shipping=3,000 / %20(cap 8,000) vs 정액 7,000 | C1 final=54,000 / C2 final=55,000 |
| S2 | subtotal=19,900 / shipping=3,000 / 배송쿠폰 3,000 | shipping fee=0 / final=19,900 |
| S3 | subtotal=28,000 / shipping=3,000 / minSpend 30,000 | 적용 실패 / 부족 2,000 / final=31,000 |
